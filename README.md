# TP-6-refactoring

## Обнаруженные проблемы качества кода

1. **Нарушение принципа единственной ответственности (SRP)**
   - Функция `process_checkout` выполняла слишком много задач: парсинг, валидацию, вычисления и формирование результата

2. **Дублирование кода (Violation of DRY)**
   - Многократные проверки элементов массива `items`
   - Повторяющиеся операции с вычислением скидок

3. **"Магические числа" (Magic Numbers)**
   - Жёстко закодированные значения: 0.21 (налог), 0.10 (скидка), 200 (порог), 50 и 10 (VIP скидки)

4. **Сложность восприятия (Violation of KISS)**
   - Большая вложенность условий в расчёте скидок
   - Смешение различных уровней абстракции

## Применённые рефакторинги

### 1. **Выделение функций (Extract Function)**
   - Созданы специализированные функции для каждой задачи:
     - `parse_request()` - извлечение данных
     - `validate_user_data()` и `validate_items()` - валидация
     - `calculate_subtotal()`, `calculate_discount()`, `calculate_taxes()` - вычисления
     - `generate_order_id()` - генерация ID

### 2. **Замена магических чисел на константы**
   - `tax_rate = 0.21`
   - `default_currence = "USD"`
   - etc.

### 3. **Улучшение читаемости**
   -  замена ручного подсчёта суммы через цикл на использование sum() с генератором
   - Использование `max()` вместо условного присваивания для non-negative значений

### 4. **Структурирование по шагам**
   - Код `process_checkout()` теперь читается как сценарий:
     1. Разбор запроса
     2. Валидация
     3. Вычисления
     4. Формирование результата

### 5. **Упрощение сложных условий**
   - Логика расчёта скидок вынесена в отдельную функцию с чёткими ветвлениями
   - Убраны вложенные условия через ранние возвраты

## Результаты рефакторинга

### Что стало проще читать:
1. **Основная функция** сократилась с 60+ строк до ~20 строк
2. **Каждая функция** имеет одну чёткую ответственность
3. **Логика расчётов** изолирована и может тестироваться отдельно
4. **Конфигурационные параметры** собраны в одном месте

### Что стало проще менять:
1. **Изменение налоговой ставки** - правка одной константы
2. **Добавление новой скидки**
3. **Изменение логики валидации** - изменение только в `validate_items()`
4. **Корректировка генерации ID** - изменение только `generate_order_id()`

### Преимущества:
1. **Улучшена тестируемость** - каждая функция может тестироваться изолированно
2. **Повышена сопровождаемость** - проще находить и исправлять ошибки
3. **Упрощено повторное использование** - функции можно использовать в других контекстах
4. **Соблюдены принципы SOLID** - особенно SRP и OCP

## Запуск тестов
```bash
pytest test_order_processing.py -v
